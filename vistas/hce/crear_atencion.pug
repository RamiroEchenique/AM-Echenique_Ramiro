extends ../layout.pug

block js 
  script(src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js",
    integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz",
    crossorigin="anonymous")
  script.
    document.addEventListener('DOMContentLoaded', () => {
      const templateDropdown = document.getElementById('templateDropdown');
      const evolucionTexto = document.getElementById('evoluciontexto');

      templateDropdown.addEventListener('change', (event) => {
        const template = event.target.value;
        switch (template) {
          case 'template1':
            evolucionTexto.value = "Fecha y hora: #{paciente[0].fecha}  #{paciente[0].hora_inicio} \nMotivo de la consulta: #{paciente[0].motivo}  \nTratamiento recomendado: \nObservaciones: ";
            break;
          case 'template2':
            evolucionTexto.value = "Fecha: #{paciente[0].fecha}  \nHora: #{paciente[0].hora_inicio}  \nMotivo: #{paciente[0].motivo}  \nTratamiento: \nComentarios: ";
            break;
          default:
            evolucionTexto.value = '';
            break;
        }
      });
    });

block contenido
  .container.mt-2
    .row
      .col-md-12
        h1.text-center.mt-0.mb-5 Sistema de Atenciones Médicas  
      .col-md-10.offset-md-1
        // Resto del contenedor principal
        
        .row
          // Columna de Detalles del Turno, en su propio recuadro
          .col-md-4 
            .card.border-primary.mb-3 
              .card-body
                h4 Detalles del Turno
                ul.list-group.list-group-flush
                  li.list-group-item
                    strong Día: 
                    | #{paciente[0].fecha}  
                  li.list-group-item
                    strong Hora: 
                    | #{paciente[0].hora_inicio} - #{paciente[0].hora_fin}
                  li.list-group-item
                    strong Motivo: 
                    | #{paciente[0].motivo}
                  li.list-group-item
                    strong Estado: 
                    span(class=`badge ${paciente[0].estadonombre === 'Pendiente' ? 'bg-warning' : paciente[0].estadonombre === 'Atendido' ? 'bg-success' : 'bg-danger'}`) #{paciente[0].estadonombre} 
                      
          
          // Columna de Datos Personales
          .col-md-4
            .card
              .card-body
                h4 Datos Personales
                ul.list-group.list-group-flush
                  li.list-group-item
                    strong Nombre: 
                    | #{paciente[0].nombre} #{paciente[0].apellido}
                  li.list-group-item
                    strong Fecha de Nacimiento: 
                    | #{paciente[0].fecha_nacimiento}
                  li.list-group-item
                    strong Género: 
                    | #{paciente[0].genero}
                  li.list-group-item
                    strong DNI: 
                    | #{paciente[0].dni}
          
          // Columna de Contacto
          .col-md-4
            .card
              .card-body
                h4 Contacto
                ul.list-group.list-group-flush
                  li.list-group-item
                    strong Teléfono: 
                    | #{paciente[0].telefono}
                  li.list-group-item
                    strong Email: 
                    | #{paciente[0].Email}
                  li.list-group-item
                    strong Obra Social: 
                    | #{paciente[0].ObraSocial}
                  li.list-group-item
                    strong Estado: 
                    | #{paciente[0].estado ? 'Activo' : 'Inactivo'}

    .row.mt-0
      .col-md-12
        h4.text-center.mt-4 ATENCIÓN MÉDICA
        ul.nav.nav-tabs#hceTabs(role='tablist')
          li.nav-item
            a.nav-link.active#evoluciones-tab(data-bs-toggle="tab" href="#evoluciones" role="tab" aria-controls="evoluciones" aria-selected="true") Evoluciones
          li.nav-item
            a.nav-link#diagnosticos-tab(data-bs-toggle="tab" href="#diagnosticos" role="tab" aria-controls="diagnosticos" aria-selected="false") Diagnósticos
          li.nav-item
            a.nav-link#alergias-tab(data-bs-toggle="tab" href="#alergias" role="tab" aria-controls="alergias" aria-selected="false") Alergias
          li.nav-item
            a.nav-link#antecedentes-tab(data-bs-toggle="tab" href="#antecedentes" role="tab" aria-controls="antecedentes" aria-selected="false") Antecedentes Patológicos
          li.nav-item
            a.nav-link#habitos-tab(data-bs-toggle="tab" href="#habitos" role="tab" aria-controls="habitos" aria-selected="false") Hábitos
          li.nav-item
            a.nav-link#medicamentos-tab(data-bs-toggle="tab" href="#medicamentos" role="tab" aria-controls="medicamentos" aria-selected="false") Medicamentos

        .tab-content#hceTabsContent
          .tab-pane.fade.show.active#evoluciones(role="tabpanel" aria-labelledby="evoluciones-tab")
            form(method="post" action=`/pacientes/atender/${paciente[0].idturno}`)
              .mb-3
                label(for="templateDropdown") Seleccionar Template
                select.form-control#templateDropdown
                  option(value="") -- Seleccione un Template --
                  option(value="template1") Template 1
                  option(value="template2") Template 2
              .mb-3
                label(for="motivo") Detalle de la evolución
                textarea.form-control(name="evoluciontexto" id="evoluciontexto" rows="8")
              .row.mt-4 
                .col-md-12.text-center 
                  button.btn.btn-primary(type="submit") Guardar Evolución

          .tab-pane.fade#diagnosticos(role="tabpanel" aria-labelledby="diagnosticos-tab") 
            form(method="post" action=`/pacientes/atender/${paciente[0].idturno}/diagnostico`) 
              .mb-3 
                label(for="diagnostico1") Diagnóstico 1 
                textarea.form-control(name="diagnostico1" id="diagnostico1" rows="3") 
              .mb-3 
                label(for="diagnostico2") Diagnóstico 2 
                textarea.form-control(name="diagnostico2" id="diagnostico2" rows="3")

          //- Pestaña de Alergias
          .tab-pane.fade#alergias(role="tabpanel" aria-labelledby="alergias-tab")
            h4.mt-2 Registrar Nueva Alergia
            form(method="post" action=`/pacientes/atender/${paciente[0].idturno}/alergias`)
              .mb-3
                label(for="nombre") Nombre de la alergia
                input.form-control(type="text" name="nombre" required)
              .mb-3
                label(for="importancia") Importancia
                select.form-control(name="importancia" required)
                  option(value="leve") Leve
                  option(value="normal") Normal
                  option(value="alta") Alta
              .mb-3
                label(for="fecha_desde") Fecha Desde
                input.form-control(type="date" name="fecha_desde" required)
              .mb-3
                label(for="fecha_hasta") Fecha Hasta
                input.form-control(type="date" name="fecha_hasta")
          //- Pestaña de Antecedentes Patológicos
          .tab-pane.fade#antecedentes(role="tabpanel" aria-labelledby="antecedentes-tab")
            h4 Registrar Antecedentes Patológicos
            form(method="post" action=`/pacientes/atender/${paciente[0].idturno}/antecedentes`)
              .mb-3
                label(for="antecedenteTexto") Descripción del Antecedente
                textarea.form-control(name="antecedenteTexto" id="antecedenteTexto" rows="4" required)
              .mb-3
                label(for="fecha_desde_antecedente") Fecha Desde
                input.form-control(type="date" name="fecha_desde_antecedente" required)
              .mb-3
                label(for="fecha_hasta_antecedente") Fecha Hasta
                input.form-control(type="date" name="fecha_hasta_antecedente")
          //- Pestaña de habitos
          .tab-pane.fade#habitos(role="tabpanel" aria-labelledby="habitos-tab")
          
            h4 Registrar habitos
            form(method="post" action=`/pacientes/atender/${paciente[0].idturno}/habitos`)
              .mb-3
                label(for="habitosTexto") Descripción de los Hábitos
                textarea.form-control(name="habitosTexto" id="habitosTexto" rows="4" required)
              .mb-3
                label(for="fecha_desde_habitos") Fecha Desde
                input.form-control(type="date" name="fecha_desde_habitos" required)
              .mb-3
                label(for="fecha_hasta_habitos") Fecha Hasta
                input.form-control(type="date" name="fecha_hasta_habitos")  
          //- Pestaña de habitos      
          .tab-pane.fade#medicamentos(role="tabpanel" aria-labelledby="medicamentos-tab") 
            form(method="post" action=`/pacientes/atender/${paciente[0].idturno}/medicamentos`) 
              .mb-3 
                label(for="medicamentos") medicamentos 
                textarea.form-control(name="medicamentos" id="medicamentos" rows="3")           
                            
        //cerrar consulta
          .row.mt-4 
            .col-md-12.text-center 
              button.btn.btn-primary(type="submit") Cerrar consulta
          
